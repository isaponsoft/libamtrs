# INARI-KVS

伏見稲荷大社の大量に並んでいる鳥居を見て思いついたKey Value Storeです。機能を絞ってオーバーヘッドを少なくすることを念頭に作っています。

## プロトコル

1バイト目は 9CH 固定で、簡単なチェックサムになります。2バイト目はコマンドを示す1バイトの値です。

| Code | Command       |
| ---- | ------------- |
| 1    | get KEY       |
| 2    | set KEY VALUE |
| 3    | begin         |
| 4    | end           |
| 5    | getkeys KEY   |
|      |               |

## 対話モード

inarikvsには対話モードが備わっています。対話モードで入力されたコマンドは必要に応じてバイナリプロトコルでサーバーとやりとりします。

## キー

使用できない文字 NUL(0) \r \n " '

キーの先頭を次のように [] で囲うとテーブルとして扱われます。テーブルを使用すると、キーの名前が内部で圧縮されるため、ストレージやメモリの使用量を少しだけ節約することができます。また、データベースがあまりにも巨大な場合、テーブルを分割することで検索速度が速くなる場合があります。

```shell
> set [Table1]Key Hello
> get [Table1]Key
Hello
> table Table1
> get Key
Hello
```







## コマンド

### GET

```shell
get KEY
```

### SET

```shell
set KEY VALUE
```

### GETKEYS

```shell
05:N4:[L4:KEY...]
getkeys KEY...
```

指定するKEYの値を読み取ります。ただし、読み取った値が別のキーを示すものとして、それらの値を読み込んで返します。

例えば、"USER01KEYS" というキーに "U01Dat U01St U01Inf" という値が入っていた場合、"U01Dat", "U01St", "U01Inf" の３つのキーを読み取って返します。

### メンテナンスモードコマンド

対話モードでのみ使用可能なコマンドです。

### MAXDEPTH

```shell
maxdepth
```

すべてのキーを検索し、ノードの最大深度を調べます。深度が深くなりすぎると検索速度が遅くなるため、そういった場合はテーブルを分けるなどして深度を浅くすることをお勧めします。

### TABLETO

```shell
tableto TABLENAME KEYREGEX
```

KEYREGEXで指定するキーをTABLENAMEで指定するテーブルへ移動します。





